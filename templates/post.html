{% extends "base.html" %}
{% block content %}
{% load crispy_forms_tags %}
{% load cloudinary %}
{% if user.is_authenticated %}

<h1 class="display-1 title-style">{{ adventure.name }}<i class="fa-solid fa-sun"></i></h1>
<h2 class="display-5">Destinations:</h2>
{% if messages %}
{% for message in messages %}
    <div class="alert {{ message.tags }}" id="message_destination" role="alert">
        {{ message }}
    </div>
{% endfor %}
{% endif %}
{% for post in posts %}
<div class="card  container-sm destination-card">
  {% if "placeholder" in post.featured_image.url %}
  <img src="https://res.cloudinary.com/djs04srkx/image/upload/c_fill,g_auto,h_250,w_970/b_rgb:000000,fl_relative,w_0.5,y_0.18/v1689779263/samples/landscapes/architecture-signs.jpg" class="post-card-image">
  {% else %}
  <img src=" {{ post.featured_image.url }}" class="post-card-image">
  {% endif %}
    <div class="card-body">
      <h5 class="card-title display-6 title-style">{{ post.title }}</h5>
      <p class="card-text">{{ post.content }}</p>
    </div>
    <ul class="list-group list-group-flush">
      <li class="list-group-item">Destination Created: {{ post.created_on|date:"M d, Y" }}</li>
    </ul>
    <div class="card-buttons d-flex justify-content-evenly align-items-center">
    {% if perms.blog.edit_post %}
      <a href="{% url 'edit_post' post.id adventure.id user.id %}" class="card-link"><i class="fa-solid fa-pen-to-square"></i></a>
      {% endif %}
    {% if perms.blog.delete_post %}
      <a onclick="return confirm('Are you sure you want to delete {{ post.title }}?')" href="{% url 'delete_post' post.id adventure.id user.id %}" class="card-link"><i id="trash" class="fa-solid fa-trash"></i></a>
    {% endif %}
    </div>
    </div>
  </div>
{% empty %}
        <tr><td>You have no Destinations planed.</td></tr>  
{% endfor %}
<h4>Comments: </h4>
{% for comment in comments %}
<div class="card container-fluid container-sm comment">
    <div class="card-body text-center d-flex bd-highlight">
        <figure class="p-2 w-100 bd-highlight align-self-center" style="margin: 0;">
            <blockquote class="blockquote">
            <p>{{ comment.body }}</p>
            </blockquote>
            <figcaption class="blockquote-footer" style="margin: 0; text-transform: capitalize;">
            {{ comment.name}}
            </figcaption>
        </figure>
      {% if comment.name == user.username %}
      <a onclick="return confirm('Are you sure you want to delete this Comment?')" href="{% url 'delete_comment' adventure.id user.id comment.id %}" class="p-2 flex-shrink-1 bd-highlight" id="comment-delete-btn"><i class="fa-regular fa-circle-xmark"></i></a>
      {% endif %}
      </div>
  </div>
{% endfor %}

<div class="d-flex justify-content-end justify-content-around" >
  {% if perms.blog.add_comment %}
<a href="{% url 'add_comment' adventure.id user.id %}" class="card-link"><button type="button" class="btn btn-success">Comment <i class="fa-solid fa-comments"></i></button></a>
  {% endif %}
</div>

<div class="post-button">
{% if perms.blog.add_post %}
<button type="submit" class="btn btn-primary" id="addPostBtn">New Destination</button>
{% endif %}
</div>
<div id="addPostModal">
  <h3 class="display-1">New Destination</h3>
  <form method="POST" class="container" enctype="multipart/form-data">
      {{ post_form|crispy }}
      {% csrf_token %}
      <button type="submit" class="btn btn-success close" style="width: 100px; margin-top: 10px;"><i class="fa-regular fa-paper-plane"></i></button>
  </form>
</div>
{% else %}
<div class="position-absolute top-50 start-50 translate-middle">
  <p class="card">Oops! it seems you are not logged in, log in or create an account here!</p>
    <div class="d-flex justify-content-center">
      <a href="{% url 'account_login' %}"><button type="button" class="btn btn-light">sign in!</button></a>
    </div>
  </div>
{% endif %}
{% endblock %}